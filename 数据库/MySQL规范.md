# MySQL规范

## 建表规约

1. 用`is_xxx`表示是否概念，数据类型`unsinged tinyint`
2. 表名字段名一律小写，因为Windows不区分大小写，Linux区分大小写
3. 表名不适用复数名词
4. 禁用保留字
5. 主键索引：`pk_xxx`，唯一索引：`uk_xxx`，普通索引：`idx_xxx`
6. 小数类型使用decimal，禁止使用double和float，因为存在精度损失，精度超过decimal范围建议将整数小数分开存储
7. 存储长度变化不大使用char
8. varchar长度不要超过5000，超过定义为text，独立出一张表用主键来对应
9. 表必备三字段：`id,gmt_create,gmt_modified`其中那个gmt_create表示主动式创建，gmt_modified表示被动式更新
10. 表名：业务名称_表的作用
11. 字段含义改变后及时更新注释
12. 单表数据超过500w行或者单表容量超过2GB进行分表分库，如果预计三年内不会超出，不要在建表时进行分库分表

## 索引规约

1. 具有唯一特性的字段必须建成唯一索引
2. 超过三个表禁止join。需要join的字段数据类型保持绝对一致；多表关联查询时，被关联的字段需要有索引
3. 在varchar字段上建立索引必须指定索引长度
4. 页面搜索禁左模糊或全模糊
5. SQL性能优化的目标：至少是range级别，要求是ref级别，最好是consts
   * consts：单表中最多只有一个匹配行，在优化阶段即可读到数据
   * ref：使用普通索引
   * range：对索引进行范围检索
6. 建立组合索引时区分度最高的放在最左边
7. 防止因字段类型不同造成的隐式转换，导致索引失效

## ORM映射

1. 查询时不要使用\*作为查询的字段列表
2. 不要使用resultClass当返回参数，定义\<resultMap\>
3. sql.xml配置参数使用#{}，#param#，不要使用${}，容易出现SQL注入
4. iBATIS自带的queryForList()不推荐使用
5. 不允许将HashMap和HashTable作为查询结果集的输出
6. 更新数据表记录时，同事更新gmt_modified字段